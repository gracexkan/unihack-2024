import pathlib
import textwrap

import google.generativeai as genai

from IPython.display import display
from IPython.display import Markdown

import os

def to_markdown(text):
  text = text.replace('•', '  *')
  return Markdown(textwrap.indent(text, '> ', predicate=lambda _: True))

medical_info = """
"warnings_and_cautions": [
        "5 WARNINGS AND PRECAUTIONS • Patients should not use VIAGRA if sexual activity is inadvisable due to cardiovascular status ( 5.1 ) • Patients should seek emergency treatment if an erection lasts >4 hours. Use VIAGRA with caution in patients predisposed to priapism ( 5.2 ) • Patients should stop VIAGRA and seek medical care if a sudden loss of vision occurs in one or both eyes, which could be a sign of non arteritic anterior ischemic optic neuropathy (NAION). VIAGRA should be used with caution, and only when the anticipated benefits outweigh the risks, in patients with a history of NAION. Patients with a \"crowded\" optic disc may also be at an increased risk of NAION. ( 5.3 ) • Patients should stop VIAGRA and seek prompt medical attention in the event of sudden decrease or loss of hearing ( 5.4 ) • Caution is advised when VIAGRA is co-administered with alpha-blockers or anti-hypertensives. Concomitant use may lead to hypotension ( 5.5 ) • Decreased blood pressure, syncope, and prolonged erection may occur at higher sildenafil exposures. In patients taking strong CYP inhibitors, such as ritonavir, sildenafil exposure is increased. Decrease in VIAGRA dosage is recommended ( 2.4 , 5.6 ) 5.1 Cardiovascular There is a potential for cardiac risk of sexual activity in patients with preexisting cardiovascular disease. Therefore, treatments for erectile dysfunction, including VIAGRA, should not be generally used in men for whom sexual activity is inadvisable because of their underlying cardiovascular status. The evaluation of erectile dysfunction should include a determination of potential underlying causes and the identification of appropriate treatment following a complete medical assessment. VIAGRA has systemic vasodilatory properties that resulted in transient decreases in supine blood pressure in healthy volunteers (mean maximum decrease of 8.4/5.5 mmHg), [ see Clinical Pharmacology (12.2) ]. While this normally would be expected to be of little consequence in most patients, prior to prescribing VIAGRA, physicians should carefully consider whether their patients with underlying cardiovascular disease could be affected adversely by such vasodilatory effects, especially in combination with sexual activity. Use with caution in patients with the following underlying conditions which can be particularly sensitive to the actions of vasodilators including VIAGRA – those with left ventricular outflow obstruction (e.g., aortic stenosis, idiopathic hypertrophic subaortic stenosis) and those with severely impaired autonomic control of blood pressure. There are no controlled clinical data on the safety or efficacy of VIAGRA in the following groups; if prescribed, this should be done with caution. • Patients who have suffered a myocardial infarction, stroke, or life-threatening arrhythmia within the last 6 months; • Patients with resting hypotension (BP <90/50 mmHg) or hypertension (BP >170/110 mmHg); • Patients with cardiac failure or coronary artery disease causing unstable angina. 5.2 Prolonged Erection and Priapism Prolonged erection greater than 4 hours and priapism (painful erections greater than 6 hours in duration) have been reported infrequently since market approval of VIAGRA. In the event of an erection that persists longer than 4 hours, the patient should seek immediate medical assistance. If priapism is not treated immediately, penile tissue damage and permanent loss of potency could result. VIAGRA should be used with caution in patients with anatomical deformation of the penis (such as angulation, cavernosal fibrosis or Peyronie's disease), or in patients who have conditions which may predispose them to priapism (such as sickle cell anemia, multiple myeloma, or leukemia). However, there are no controlled clinical data on the safety or efficacy of VIAGRA in patients with sickle cell or related anemias. 5.3 Effects on the Eye Physicians should advise patients to stop use of all phosphodiesterase type 5 (PDE5) inhibitors, including VIAGRA, and seek medical attention in the event of a sudden loss of vision in one or both eyes. Such an event may be a sign of non-arteritic anterior ischemic optic neuropathy (NAION), a rare condition and a cause of decreased vision including permanent loss of vision, that has been reported rarely post-marketing in temporal association with the use of all PDE5 inhibitors. Based on published literature, the annual incidence of NAION is 2.5–11.8 cases per 100,000 in males aged ≥ 50. An observational case-crossover study evaluated the risk of NAION when PDE5 inhibitor use, as a class, occurred immediately before NAION onset (within 5 half-lives), compared to PDE5 inhibitor use in a prior time period. The results suggest an approximate 2-fold increase in the risk of NAION, with a risk estimate of 2.15 (95% CI 1.06, 4.34). A similar study reported a consistent result, with a risk estimate of 2.27 (95% CI 0.99, 5.20). Other risk factors for NAION, such as the presence of \"crowded\" optic disc, may have contributed to the occurrence of NAION in these studies. Neither the rare post-marketing reports, nor the association of PDE5 inhibitor use and NAION in the observational studies, substantiate a causal relationship between PDE5 inhibitor use and NAION [ see Adverse Reactions (6.2) ]. Physicians should consider whether their patients with underlying NAION risk factors could be adversely affected by use of PDE5 inhibitors. Individuals who have already experienced NAION are at increased risk of NAION recurrence. Therefore, PDE5 inhibitors, including VIAGRA, should be used with caution in these patients and only when the anticipated benefits outweigh the risks. Individuals with \"crowded\" optic disc are also considered at greater risk for NAION compared to the general population, however, evidence is insufficient to support screening of prospective users of PDE5 inhibitors, including VIAGRA, for this uncommon condition. There are no controlled clinical data on the safety or efficacy of VIAGRA in patients with retinitis pigmentosa (a minority of these patients have genetic disorders of retinal phosphodiesterases); if prescribed, this should be done with caution. 5.4 Hearing Loss Physicians should advise patients to stop taking PDE5 inhibitors, including VIAGRA, and seek prompt medical attention in the event of sudden decrease or loss of hearing. These events, which may be accompanied by tinnitus and dizziness, have been reported in temporal association to the intake of PDE5 inhibitors, including VIAGRA. It is not possible to determine whether these events are related directly to the use of PDE5 inhibitors or to other factors [ see Adverse Reactions (6.1 , 6.2) ]. 5.5 Hypotension when Co-administered with Alpha-blockers or Anti-hypertensives Alpha-blockers Caution is advised when PDE5 inhibitors are co-administered with alpha-blockers. PDE5 inhibitors, including VIAGRA, and alpha-adrenergic blocking agents are both vasodilators with blood pressure lowering effects. When vasodilators are used in combination, an additive effect on blood pressure may occur. In some patients, concomitant use of these two drug classes can lower blood pressure significantly [ see Drug Interactions (7.2) and Clinical Pharmacology (12.2) ] leading to symptomatic hypotension (e.g., dizziness, lightheadedness, fainting). Consideration should be given to the following: • Patients who demonstrate hemodynamic instability on alpha-blocker therapy alone are at increased risk of symptomatic hypotension with concomitant use of PDE5 inhibitors. Patients should be stable on alpha-blocker therapy prior to initiating a PDE5 inhibitor. • In those patients who are stable on alpha-blocker therapy, PDE5 inhibitors should be initiated at the lowest dose [ see Dosage and Administration (2.3) ]. • In those patients already taking an optimized dose of a PDE5 inhibitor, alpha-blocker therapy should be initiated at the lowest dose. Stepwise increase in alpha-blocker dose may be associated with further lowering of blood pressure when taking a PDE5 inhibitor. • Safety of combined use of PDE5 inhibitors and alpha-blockers may be affected by other variables, including intravascular volume depletion and other anti-hypertensive drugs. Anti-hypertensives VIAGRA has systemic vasodilatory properties and may further lower blood pressure in patients taking anti-hypertensive medications. In a separate drug interaction study, when amlodipine, 5 mg or 10 mg, and VIAGRA, 100 mg were orally administered concomitantly to hypertensive patients mean additional blood pressure reduction of 8 mmHg systolic and 7 mmHg diastolic were noted [ see Drug Interactions (7.3) and Clinical Pharmacology (12.2) ]. 5.6 Adverse Reactions with the Concomitant Use of Ritonavir The concomitant administration of the protease inhibitor ritonavir substantially increases serum concentrations of sildenafil (11-fold increase in AUC). If VIAGRA is prescribed to patients taking ritonavir, caution should be used. Data from subjects exposed to high systemic levels of sildenafil are limited. Decreased blood pressure, syncope, and prolonged erection were reported in some healthy volunteers exposed to high doses of sildenafil (200–800 mg). To decrease the chance of adverse reactions in patients taking ritonavir, a decrease in sildenafil dosage is recommended [ see Dosage and Administration (2.4) , Drug Interactions (7.4) , and Clinical Pharmacology (12.3) ]. 5.7 Combination with other PDE5 Inhibitors or Other Erectile Dysfunction Therapies The safety and efficacy of combinations of VIAGRA with other PDE5 Inhibitors, including REVATIO or other pulmonary arterial hypertension (PAH) treatments containing sildenafil, or other treatments for erectile dysfunction have not been studied. Such combinations may further lower blood pressure. Therefore, the use of such combinations is not recommended. 5.8 Effects on Bleeding There have been postmarketing reports of bleeding events in patients who have taken VIAGRA. A causal relationship between VIAGRA and these events has not been established. In humans, VIAGRA has no effect on bleeding time when taken alone or with aspirin. However, in vitro studies with human platelets indicate that sildenafil potentiates the antiaggregatory effect of sodium nitroprusside (a nitric oxide donor). In addition, the combination of heparin and VIAGRA had an additive effect on bleeding time in the anesthetized rabbit, but this interaction has not been studied in humans. The safety of VIAGRA is unknown in patients with bleeding disorders and patients with active peptic ulceration. 5.9 Counseling Patients About Sexually Transmitted Diseases The use of VIAGRA offers no protection against sexually transmitted diseases. Counseling of patients about the protective measures necessary to guard against sexually transmitted diseases, including the Human Immunodeficiency Virus (HIV), may be considered."
"""

prompt = """
Given the info:
{}

Summarise this info as:
Medication name:
Duration (number of days): Put -1 if it is not provided
Frequency (dosage taken per day): Put 0 if it is "as needed", -1 if not provided
Restrictions:
Severity (low or high - will it cause health problems if the user does not take it at all):

Format the response as a parseable json:
medicationName (String), duration (int), frequency (int), restrictions (String[]), severity (String)

Put fields as null if you can't find info on them. Do not put in comments. Only send back the json.
""".format(medical_info)

# Or use `os.getenv('GOOGLE_API_KEY')` to fetch an environment variable.
GOOGLE_API_KEY=os.getenv('GOOGLE_API_KEY') # userdata.get('GOOGLE_API_KEY')

genai.configure(api_key=GOOGLE_API_KEY)

model = genai.GenerativeModel('gemini-pro')   

response = model.generate_content(prompt)

to_markdown(response.text)
print(response.text)